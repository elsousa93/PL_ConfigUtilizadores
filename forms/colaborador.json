{
    "className": "org.joget.apps.form.model.Form",
    "elements": [
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [{
                    "className": "org.joget.marketplace.FormRecordLockingField",
                    "properties": {
                        "displayNameFormat": "firstLast",
                        "formDefId": "colaborador",
                        "id": "record_lock",
                        "label": "O formulário está bloqueado por",
                        "lockDuration": "5",
                        "validator": {
                            "className": "org.joget.marketplace.FormRecordLockingValidator",
                            "properties": {
                                "errorMessage": "Este colaborador já está a ser editado",
                                "formDefId": "colaborador"
                            }
                        }
                    }
                }],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "section9",
                "join": "",
                "label": "",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.SelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "user_colaborador",
                            "label": "Colaborador",
                            "multiple": "",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.plugin.enterprise.UserOptionsBinder",
                                "properties": {
                                    "addEmptyOption": "true",
                                    "cacheInterval": "",
                                    "deptId": "",
                                    "emptyLabel": "",
                                    "groupId": "",
                                    "grouping": "",
                                    "optionLabel": "",
                                    "orgId": "PL",
                                    "useAjax": ""
                                }
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "validator": {
                                "className": "org.joget.apps.form.lib.BeanShellValidator",
                                "properties": {
                                    "decoration": "",
                                    "script": "import java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.Form;\r\nimport org.joget.commons.util.LogUtil;\r\nimport org.joget.apps.form.model.FormStoreBinder;\r\nimport org.joget.apps.form.service.FormUtil;\r\nimport org.joget.apps.app.model.AppDefinition;\r\n\r\npublic boolean duplicado(Element element, FormData formData){\r\n    \r\n    Boolean result = true;\r\n    \r\n    if(\"#requestParam._mode#\".equals(\"add\")){\r\n        //Configure field to validate - UPDATE HERE\r\n        String fieldId = \"user_colaborador\";\r\n    \r\n        //Get element value\r\n        Form form = FormUtil.findRootForm(element);\r\n        Element field = FormUtil.findElement(fieldId, form, formData);\r\n        String fieldValue = FormUtil.getElementPropertyValue(field, formData);\r\n        \r\n        //Estabelecer conexão à base de dados\r\n        Connection con = null;\r\n        PreparedStatement stmt = null;\r\n        ResultSet rs = null;\r\n        \r\n        String colaborador = FormUtil.getElementParameterName(element);\r\n        \r\n        try{\r\n            \r\n            DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n            con = ds.getConnection();\r\n            \r\n            //If element is not filled give error message\r\n            if (fieldValue == null || fieldValue.equals(\"\")){\r\n                formData.addFormError(colaborador, \"Campo obrigatório\");\r\n                result = false;\r\n\r\n            } else{\r\n    \r\n                if(!con.isClosed()){\r\n                \r\n                    String query= \"SELECT * FROM app_fd_info_colaboradores WHERE c_user_colaborador = ?\";\r\n                    stmt = con.prepareStatement(query);\r\n                    stmt.setObject(1, fieldValue);\r\n                    rs = stmt.executeQuery();\r\n                    \r\n                    if(rs.next()){\r\n                        result = false;\r\n                        formData.addFormError(colaborador, \"Colaborador já existe\");\r\n                    } else {\r\n                        result = true;\r\n                    }\r\n                    \r\n                } \r\n            }\r\n            \r\n        }catch(Exception e){\r\n        \r\n            LogUtil.error(\"Gestão utilizadores - user_colaborador\", e, \"Error getting info from DB\");\r\n            \r\n        }finally{\r\n            \r\n            try{\r\n                if(rs != null){\r\n                rs.close();\r\n                }\r\n                if(stmt != null){\r\n                    stmt.close();\r\n                }\r\n                if(con != null && !con.isClosed()) {\r\n                    con.close();\r\n                }\r\n            }catch(Exception e){\r\n                LogUtil.error(\"Gestão utilizadores - user_colaborador\", e, \"Error closing DB connection\");\r\n            }\r\n            \r\n        }\r\n    }\r\n    \r\n    \r\n    return result;\r\n}\r\n\r\n//call load method with injected variable\r\nreturn duplicado(element, formData);"
                                }
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "js_colaborador",
                            "label": "",
                            "value": "<script>\r\n    \r\n    $(document).ready(function(){\r\n        \r\n        //SELECT BOX COLABORADOR\r\n        let selectBox = document.querySelector('[id*=\"user_colaborador\"]');\r\n        \r\n        if(\"#requestParam._mode#\" === \"edit\"){\r\n            selectBox.setAttribute(\"disabled\",\"true\");\r\n        }\r\n        \r\n        form = document.getElementById(\"colaborador\");\r\n        \r\n        form.addEventListener(\"submit\", function(event) {\r\n            selectBox.removeAttribute(\"disabled\");\r\n        });\r\n        \r\n        \r\n        //MENSAGEM ERRO DE VALIDAÇÃO\r\n        $('body[id*=informacaoColaboradores] div.form-message').text(\"EXISTEM ERROS DE VALIDAÇÃO\");\r\n        \r\n    });\r\n    \r\n<\/script>"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "nome_completo",
                            "label": "Nome Completo",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "org.joget.apps.form.lib.DefaultValidator",
                                "properties": {
                                    "mandatory": "true",
                                    "message": "Campo obrigatório",
                                    "type": ""
                                }
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    }
                ],
                "properties": {
                    "customWidth": "",
                    "horizontal": "",
                    "label": "",
                    "width": "100%"
                }
            }],
            "properties": {
                "comment": "",
                "id": "informacaoPessoal",
                "join": "",
                "label": "Informação Pessoal",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [
                {
                    "className": "org.joget.apps.form.model.Column",
                    "elements": [
                        {
                            "className": "org.joget.apps.form.lib.DatePicker",
                            "properties": {
                                "allowManual": "",
                                "currentDateAs": "",
                                "dataFormat": "yyyy-MM-dd",
                                "datePickerType": "",
                                "endDateFieldId": "",
                                "format": "",
                                "id": "data_nascimento",
                                "label": "Data de Nascimento",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "startDateFieldId": "",
                                "validator": {
                                    "className": "",
                                    "properties": {}
                                },
                                "value": "",
                                "workflowVariable": "",
                                "yearRange": "c-10:c+10"
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "numero_cc",
                                "label": "Cartão de Cidadão",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "org.joget.apps.form.lib.DefaultValidator",
                                    "properties": {
                                        "mandatory": "",
                                        "message": "",
                                        "type": ""
                                    }
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "cedula_estagiario",
                                "label": "Cédula Estagiária",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "",
                                    "properties": {}
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        }
                    ],
                    "properties": {"width": "49%"}
                },
                {
                    "className": "org.joget.apps.form.model.Column",
                    "elements": [
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "nif",
                                "label": "NIF",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "org.joget.apps.form.lib.BeanShellValidator",
                                    "properties": {
                                        "decoration": "",
                                        "script": "/*import java.util.Arrays;\nimport org.joget.apps.form.model.Element;\nimport org.joget.apps.form.model.FormData;\nimport org.joget.apps.form.service.FormUtil;\n\nString id = FormUtil.getElementParameterName(element);\nString number = \"\";\nif(values.length > 0){\n    number = values[0];\n}\n\nif(number.isEmpty()){\n    formData.addFormError(id, \"Por favor introduza o NIF\");\n    return false;\n}\n\nfinal int max=9;\n//check if is numeric and has 9 numbers\nif (!number.matches(\"[0-9]+\") || number.length()!=max){\n    formData.addFormError(id, \"NIF deve ter 9 digitos\");\n    return false;\n}\n\nint checkSum=0;\n//calculate checkSum\nfor (int i=0; i<max-1; i++){\n\tcheckSum+=(number.charAt(i)-'0')*(max-i);\n}\nint checkDigit=11-(checkSum % 11);\n//if checkDigit is higher than 9 set it to zero\nif (checkDigit>9) checkDigit=0;\n//compare checkDigit with the last number of NIF\nif (checkDigit!=number.charAt(max-1)-'0'){\n    formData.addFormError(id, \"NIF inválido\");\n    return false;\n}*/\nreturn true;"
                                    }
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "validade_cc",
                                "label": "Data de Validade",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "org.joget.apps.form.lib.DefaultValidator",
                                    "properties": {
                                        "mandatory": "",
                                        "message": "",
                                        "type": ""
                                    }
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "cedula_profissional",
                                "label": "Cédula Profissional",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "",
                                    "properties": {}
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        }
                    ],
                    "properties": {"width": "49%"}
                }
            ],
            "properties": {
                "comment": "",
                "id": "section5",
                "join": "",
                "label": "",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [
                {
                    "className": "org.joget.apps.form.model.Column",
                    "elements": [
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "morada",
                                "label": "Morada",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "",
                                    "properties": {}
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "telemovel_pessoal",
                                "label": "Telemóvel Pessoal",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "org.joget.apps.form.lib.DefaultValidator",
                                    "properties": {
                                        "mandatory": "",
                                        "message": "",
                                        "type": ""
                                    }
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "email_pessoal",
                                "label": "E-mail Pessoal",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "org.joget.apps.form.lib.DefaultValidator",
                                    "properties": {
                                        "mandatory": "",
                                        "message": "",
                                        "type": ""
                                    }
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        }
                    ],
                    "properties": {"width": "32%"}
                },
                {
                    "className": "org.joget.apps.form.model.Column",
                    "elements": [
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "codigo_postal",
                                "label": "Código Postal",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "org.joget.apps.form.lib.DefaultValidator",
                                    "properties": {
                                        "mandatory": "",
                                        "message": "",
                                        "type": ""
                                    }
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "telemovel_profissional",
                                "label": "Telemóvel Profissional",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "org.joget.apps.form.lib.DefaultValidator",
                                    "properties": {
                                        "mandatory": "",
                                        "message": "",
                                        "type": ""
                                    }
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "email_profissional",
                                "label": "E-mail Profissional",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "org.joget.apps.form.lib.DefaultValidator",
                                    "properties": {
                                        "mandatory": "",
                                        "message": "",
                                        "type": ""
                                    }
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.CustomHTML",
                            "properties": {
                                "autoPopulate": "",
                                "id": "field32",
                                "label": "",
                                "value": "<script>\n    $(document).ready(function(){\n        var username = $(\"select[id*=user_colaborador]\").val();\n        var jogetEmail = '#user.'+username+'.email#'; \n        console.log(\"Email:\"+ jogetEmail);\n        console.log(\"User:\"+username+\"#user.a_aferreira.email#\");\n        $(\"input#email_profissional\").val(jogetEmail);\n        \n        \n    });\n    \n<\/script>"
                            }
                        }
                    ],
                    "properties": {"width": "32%"}
                },
                {
                    "className": "org.joget.apps.form.model.Column",
                    "elements": [{
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "localidade",
                            "label": "Localidade",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "org.joget.apps.form.lib.DefaultValidator",
                                "properties": {
                                    "mandatory": "",
                                    "message": "",
                                    "type": ""
                                }
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    }],
                    "properties": {"width": "32%"}
                }
            ],
            "properties": {
                "comment": "",
                "id": "informacaoContacto",
                "join": "",
                "label": "Informação de Contacto",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "numero_interno",
                            "label": "Número Colaborador",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "nome_profissional",
                            "label": "Nome Profissional",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.plugin.enterprise.MultiSelectBox",
                        "properties": {
                            "controlField": "user_colaborador",
                            "id": "equipa",
                            "label": "Equipa",
                            "multiple": "true",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.apps.form.lib.BeanShellFormBinder",
                                "properties": {
                                    "cacheInterval": "",
                                    "script": "import org.joget.apps.app.service.AppUtil;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.apps.form.service.FormUtil;\r\n\r\npublic FormRowSet load(String[] values) {\r\n    FormRowSet rows = new FormRowSet();\r\n    String user = null;\r\n\r\n    //Verificar se existe um user escolhido no campo Colaborador(ID: user_colaborador)\r\n    //Nota: para o Ajax rendering funcionar o campo relativo ao Grouping na \r\n    //tab seguinte (Advanced Options) tem que ser preenchido com user_colaborador\r\n    if (values != null && values.length > 0) { \r\n        user = values[0];\r\n        loadAux(rows,user);\r\n    }\r\n    \r\n    return rows;\r\n    }\r\n    \r\npublic void loadAux(FormRowSet rows, String username){\r\n    \r\n    //Inserir o username do user selecionado nas hash variables\r\n    String depName = \"#user.\" + username + \".department.name#\";\r\n    String depId = \"#user.\" + username + \".department.id#\";\r\n    \r\n    //System.out.println(depId);\r\n\r\n    //Processar as hash variables para ir buscar os departamentos afetos ao user\r\n    //Resultado na forma \"DEP1;DEP2\"\r\n    String userDepartmentName = AppUtil.processHashVariable(depName,null,null,null);\r\n    String userDepartmentID = AppUtil.processHashVariable(depId,null,null,null);\r\n    \r\n    //System.out.println(userDepartmentName);\r\n    \r\n    //Verificar se existe algum departamento associado e se existe um user escolhido\r\n    if(userDepartmentName.length() > 0){ \r\n        //System.out.println(userDepartmentDesc);\r\n        \r\n        //Separar os varios departamentos retornados em string\r\n        String[] userDepName = userDepartmentName.split(\";\");\r\n        String[] userDepID = userDepartmentName.split(\";\");\r\n    \r\n        //Adicionar opcoes consoante departamentos do user selecionado\r\n        for(int i = 0; i < userDepName.length; i++ ){\r\n            FormRow option = new FormRow();\r\n            option.setProperty(FormUtil.PROPERTY_VALUE, userDepID[i]);\r\n            option.setProperty(FormUtil.PROPERTY_LABEL, userDepName[i]);\r\n            rows.add(option);\r\n        }\r\n    }\r\n}\r\n    \r\n//call load method with injected variable\r\nreturn load(values);",
                                    "useAjax": "true"
                                }
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "width": "40%",
                            "workflowVariable": ""
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "InformacaoEmpresarial",
                "join": "",
                "label": "Informação Empresarial",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [
                {
                    "className": "org.joget.apps.form.model.Column",
                    "elements": [
                        {
                            "className": "org.joget.apps.form.lib.TextField",
                            "properties": {
                                "encryption": "",
                                "id": "categoria_profissional",
                                "label": "Categoria Profissional",
                                "maxlength": "",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "storeNumeric": "",
                                "style": "",
                                "validator": {
                                    "className": "org.joget.apps.form.lib.DefaultValidator",
                                    "properties": {
                                        "mandatory": "",
                                        "message": "",
                                        "type": ""
                                    }
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.DatePicker",
                            "properties": {
                                "allowManual": "",
                                "currentDateAs": "",
                                "dataFormat": "yyyy-MM-dd",
                                "datePickerType": "",
                                "endDateFieldId": "",
                                "format": "",
                                "id": "data_admissao",
                                "label": "Data de Admissão",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "startDateFieldId": "",
                                "validator": {
                                    "className": "",
                                    "properties": {}
                                },
                                "value": "",
                                "workflowVariable": "",
                                "yearRange": "c-10:c+10"
                            }
                        }
                    ],
                    "properties": {"width": "49%"}
                },
                {
                    "className": "org.joget.apps.form.model.Column",
                    "elements": [
                        {
                            "className": "org.joget.apps.form.lib.SelectBox",
                            "properties": {
                                "controlField": "",
                                "id": "perfil",
                                "label": "Perfil",
                                "multiple": "",
                                "options": [
                                    {
                                        "grouping": "",
                                        "label": "Júnior",
                                        "value": "junior"
                                    },
                                    {
                                        "grouping": "",
                                        "label": "Sénior",
                                        "value": "senior"
                                    }
                                ],
                                "optionsBinder": {
                                    "className": "",
                                    "properties": {}
                                },
                                "readonly": "",
                                "readonlyLabel": "",
                                "size": "",
                                "validator": {
                                    "className": "",
                                    "properties": {}
                                },
                                "value": "",
                                "workflowVariable": ""
                            }
                        },
                        {
                            "className": "org.joget.apps.form.lib.DatePicker",
                            "properties": {
                                "allowManual": "",
                                "currentDateAs": "",
                                "dataFormat": "yyyy-MM-dd",
                                "datePickerType": "",
                                "endDateFieldId": "",
                                "format": "",
                                "id": "data_cessao",
                                "label": "Data de Cessação",
                                "placeholder": "",
                                "readonly": "",
                                "readonlyLabel": "",
                                "startDateFieldId": "",
                                "validator": {
                                    "className": "",
                                    "properties": {}
                                },
                                "value": "",
                                "workflowVariable": "",
                                "yearRange": "c-10:c+10"
                            }
                        }
                    ],
                    "properties": {"width": "49%"}
                }
            ],
            "properties": {
                "comment": "",
                "id": "informacaoEmpresarial2",
                "join": "",
                "label": "",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [{
                    "className": "org.joget.apps.form.lib.TextField",
                    "properties": {
                        "encryption": "",
                        "id": "iban",
                        "label": "IBAN",
                        "maxlength": "",
                        "placeholder": "",
                        "readonly": "",
                        "readonlyLabel": "",
                        "size": "",
                        "storeNumeric": "",
                        "style": "",
                        "validator": {
                            "className": "org.joget.apps.form.lib.DefaultValidator",
                            "properties": {
                                "mandatory": "",
                                "message": "",
                                "type": ""
                            }
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                }],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "informacaoBancaria",
                "join": "",
                "label": "Informação Bancária",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [
                {
                    "className": "org.joget.apps.form.model.Column",
                    "elements": [{
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "nome_emergencia",
                            "label": "Nome",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    }],
                    "properties": {"width": "49%"}
                },
                {
                    "className": "org.joget.apps.form.model.Column",
                    "elements": [{
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "encryption": "",
                            "id": "telefone_emergencia",
                            "label": "Número de telefone",
                            "maxlength": "",
                            "placeholder": "",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    }],
                    "properties": {"width": "49%"}
                }
            ],
            "properties": {
                "comment": "",
                "id": "section7",
                "join": "",
                "label": "Contacto de Emergência",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.CheckBox",
                        "properties": {
                            "controlField": "",
                            "id": "departamentos_grupo",
                            "label": "Grupos Departamentos",
                            "options": [
                                {
                                    "grouping": "",
                                    "label": "Contratação",
                                    "value": "CNT"
                                },
                                {
                                    "grouping": "",
                                    "label": "Contratação ABN",
                                    "value": "CNT_ABN"
                                },
                                {
                                    "grouping": "",
                                    "label": "Contratação BCP",
                                    "value": "CNT_BCP"
                                },
                                {
                                    "grouping": "",
                                    "label": "Contratação BIC",
                                    "value": "CNT_BIC"
                                },
                                {
                                    "grouping": "",
                                    "label": "Contratação BST",
                                    "value": "CNT_BST"
                                },
                                {
                                    "grouping": "",
                                    "label": "Contratação CTT",
                                    "value": "CNT_CTT"
                                },
                                {
                                    "grouping": "",
                                    "label": "Contratação GEN",
                                    "value": "CNT_GEN"
                                },
                                {
                                    "grouping": "",
                                    "label": "Contratação MTG",
                                    "value": "CNT_MTG"
                                },
                                {
                                    "grouping": "",
                                    "label": "Contratação NVB",
                                    "value": "CNT_NVB"
                                },
                                {
                                    "grouping": "",
                                    "label": "Filtro",
                                    "value": "FLT"
                                },
                                {
                                    "grouping": "",
                                    "label": "Filtro GEN",
                                    "value": "FLT_GEN"
                                },
                                {
                                    "grouping": "",
                                    "label": "Produção",
                                    "value": "PRD"
                                },
                                {
                                    "grouping": "",
                                    "label": "Produção GEN",
                                    "value": "PRD_GEN"
                                },
                                {
                                    "grouping": "",
                                    "label": "Validação",
                                    "value": "VAL"
                                },
                                {
                                    "grouping": "",
                                    "label": "Validação BCP",
                                    "value": "VAL_BCP"
                                },
                                {
                                    "grouping": "",
                                    "label": "Validação BNI",
                                    "value": "VAL_BNI"
                                },
                                {
                                    "grouping": "",
                                    "label": "Validação BST",
                                    "value": "VAL_BST"
                                },
                                {
                                    "grouping": "",
                                    "label": "Validação GEN",
                                    "value": "VAL_GEN"
                                }
                            ],
                            "optionsBinder": {
                                "className": "",
                                "properties": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.plugin.enterprise.MultiSelectBox",
                        "properties": {
                            "controlField": "",
                            "id": "departamentos",
                            "label": "Departamentos",
                            "multiple": "true",
                            "options": [],
                            "optionsBinder": {
                                "className": "org.joget.plugin.enterprise.JdbcOptionsBinder",
                                "properties": {
                                    "addEmpty": "",
                                    "cacheInterval": "",
                                    "jdbcDatasource": "default",
                                    "sql": "SELECT * FROM dir_department WHERE organizationId = 'PL' ;",
                                    "useAjax": ""
                                }
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "validator": {
                                "className": "org.joget.apps.form.lib.DefaultValidator",
                                "properties": {
                                    "mandatory": "true",
                                    "message": "Campo obrigatório",
                                    "type": ""
                                }
                            },
                            "value": "",
                            "width": "40%",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "field27",
                            "label": "",
                            "value": "<script type=\"text/javascript\">\r\n$(function(){\r\n    $(\"#submit\").val(\"GUARDAR\");\r\n    $(\"#cancel\").text(\"CANCELAR\");\r\n});\r\n\r\n\r\n$(document).ready(function(){\r\n    \r\n    $(\"div[id^=departamentos_grupo] input[type=checkbox]\").each(function(){\r\n        $(this).on('change', function(){\r\n            var checkBox = $(this).val();\r\n            if(this.checked){\r\n               \r\n               $(\"div[id=departamentos_chosen] li\").click();\r\n               $(\"div[id=departamentos_chosen] div ul li\").filter(function(){\r\n                    if($(this).text().includes(checkBox) && !$(this).text().includes(\"RPA\")){\r\n                        var index = $(this).attr('data-option-array-index');\r\n                        var name = $(this).text();\r\n                        $(FormUtil.getField(\"departamentos\")).find(\"option[value=\"+name+\"]\").prop('selected', true);\r\n                        $(FormUtil.getField(\"departamentos\")).trigger(\"chosen:updated\");\r\n                    }\r\n               });\r\n               $(FormUtil.getField(\"departamentos\")).trigger(\"change\");\r\n\r\n            }else{\r\n                $(\"div[id=departamentos_chosen] li\").click();\r\n                $(\"div[id=departamentos_chosen] div ul li\").filter(function(){\r\n                    if($(this).text().includes(checkBox) && !$(this).text().includes(\"RPA\")){\r\n                       \r\n                        var index = $(this).attr('data-option-array-index');\r\n                        var name = $(this).text();\r\n                        $(FormUtil.getField(\"departamentos\")).find(\"option[value*=\"+name+\"]\").removeAttr(\"selected\");\r\n                        $(FormUtil.getField(\"departamentos\")).trigger(\"chosen:updated\");\r\n                    }\r\n               });\r\n                $(FormUtil.getField(\"departamentos\")).trigger(\"change\");\r\n               \r\n            }\r\n           \r\n        });\r\n        \r\n    });\r\n    \r\n    $(FormUtil.getField(\"departamentos\")).on('change', function(){\r\n        \r\n        $(\"div[id^=departamentos_grupo] input[type=checkbox]\").each(function(){\r\n                    var name = $(this).val();\r\n                    var checkbox = $(this);\r\n                    var validCheck = true;\r\n                if(this.checked){\r\n                    $(FormUtil.getField(\"departamentos\")).find(\"option:not(:selected)\").each(function(){\r\n                        if($(this).val().includes(name) && !$(this).text().includes(\"RPA\")){\r\n                            checkbox.removeAttr(\"checked\");\r\n                            \r\n                        }\r\n                    });\r\n                }else{\r\n                    $(FormUtil.getField(\"departamentos\")).find(\"option:not(:selected)\").each(function(){\r\n                        if($(this).val().includes(name) && !$(this).text().includes(\"RPA\")){\r\n                            validCheck = false;\r\n                        }\r\n                    });\r\n                    \r\n                    if(validCheck){\r\n                        checkbox.prop('checked', true);\r\n                    }\r\n                    \r\n                }\r\n        });\r\n        \r\n        \r\n    });\r\n    \r\n    \r\n    \r\n    \r\n});\r\n    \r\n    \r\nfunction buildChoice(index, name){\r\n    var option = \"<li class='search-choice'><span>\"+name+\"<\/span><a class='search-choice-close' data-option-array-index=\"+index+\"><\/a><\/li>\";\r\n    return option;\r\n}    \r\n<\/script>"
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "sectionDepartamentos",
                "join": "",
                "label": "Departamentos",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [{
                    "className": "org.joget.apps.form.lib.CheckBox",
                    "properties": {
                        "controlField": "",
                        "id": "grupos",
                        "label": "Grupos",
                        "options": [
                            {
                                "grouping": "",
                                "label": "Coordenador",
                                "value": "Coordenador"
                            },
                            {
                                "grouping": "",
                                "label": "Diretor Coordenador",
                                "value": "DiretorCoordenador"
                            },
                            {
                                "grouping": "",
                                "label": "Apoio Coordenador",
                                "value": "apoioCoordenador"
                            }
                        ],
                        "optionsBinder": {
                            "className": "",
                            "properties": {}
                        },
                        "readonly": "",
                        "readonlyLabel": "",
                        "validator": {
                            "className": "",
                            "properties": {}
                        },
                        "value": "",
                        "workflowVariable": ""
                    }
                }],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "section10",
                "join": "",
                "label": "Grupos",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        }
    ],
    "properties": {
        "description": "",
        "id": "colaborador",
        "loadBinder": {
            "className": "org.joget.apps.form.lib.WorkflowFormBinder",
            "properties": {}
        },
        "name": "Colaborador",
        "noPermissionMessage": "",
        "permission": {
            "className": "",
            "properties": {}
        },
        "postProcessor": {
            "className": "org.joget.apps.app.lib.BeanShellTool",
            "properties": {"script": "import org.joget.commons.util.LogUtil;\nimport org.joget.workflow.model.service.*;\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport javax.sql.DataSource;\nimport org.joget.plugin.base.Plugin;\nimport org.joget.plugin.base.PluginManager;\nimport javax.servlet.http.HttpServletRequest;\nimport org.joget.apps.app.model.AppDefinition;\nimport org.joget.apps.app.service.AppPluginUtil;\nimport org.joget.apps.app.service.AppUtil;\nimport org.joget.plugin.base.ApplicationPlugin;\nimport org.joget.plugin.base.Plugin;\nimport org.joget.plugin.base.PluginManager;\nimport org.joget.plugin.property.model.PropertyEditable;\nimport org.joget.apps.app.service.AppService;\nimport org.joget.commons.util.UuidGenerator;\n  \npublic Object execute(AppDefinition appDef, HttpServletRequest request) {\n    AppService appService = (AppService) AppUtil.getApplicationContext().getBean(\"appService\");\n    WorkflowManager workflowManager = (WorkflowManager) AppUtil.getApplicationContext().getBean(\"workflowManager\");\n    AppDefinition appDef = AppUtil.getCurrentAppDefinition();\n    \n    \n    try{\n\n        \n        Connection con = null;\n        PreparedStatement stmt = null;\n        ResultSet rs = null;\n        \n        try{\n            \n            DataSource ds = (DataSource)AppUtil.getApplicationContext().getBean(\"setupDataSource\");\n            con = ds.getConnection();\n            \n             if(!con.isClosed()){\n                 \n                String userDepartments = \"#form.info_colaboradores.departamentos#\";\n                \n                if(!userDepartments.startsWith(\"#form.info_colaboradores.departamentos\") && userDepartments != null && !userDepartments.isEmpty()){\n                    String[] deptsParsed = userDepartments.split(\";\");\n                    String userId = \"#form.info_colaboradores.user_colaborador#\";\n                    \n                    String queryDeleteDepartment = \"DELETE FROM dir_employment WHERE userId = ? ;\";\n                    stmt = con.prepareStatement(queryDeleteDepartment);\n                    stmt.setObject(1, userId);\n                    stmt.executeQuery();\n                        \n                        \n                    for(int i=0; i<deptsParsed.length; i++){\n\n                        String queryInsertDep = \"INSERT INTO dir_employment (id, userId, departmentId, organizationId) VALUES (?,?,?,?) ;\";\n                        \n                        var id = UuidGenerator.getInstance().getUuid();\n                        String departmentId = deptsParsed[i];\n                        String organizationId = \"PL\";\n                        \n                       /* LogUtil.info(\"ID \", \"CCC \" + id);\n                        LogUtil.info(\"USER ID \", \"CCC \" + userId); \n                        LogUtil.info(\"DEP ID \", \"CCC \" + deptsParsed[i]);*/\n                        \n                        stmt = con.prepareStatement(queryInsertDep);\n                        stmt.setObject(1, id);\n                        stmt.setObject(2, userId);\n                        stmt.setObject(3, deptsParsed[i]);\n                        stmt.setObject(4, \"PL\");\n                        stmt.executeQuery();\n                        \n                        \n                    }           \n                    \n                    \n                }\n                \n                String userGroups = \"#form.info_colaboradores.grupos#\";\n                \n                if(userGroups != null && userGroups.isEmpty()){\n                    String userId = \"#form.info_colaboradores.user_colaborador#\";\n                    String queryDeleteGroup = \"DELETE FROM dir_user_group WHERE userId = ? ;\";\n                    \n                    stmt = con.prepareStatement(queryDeleteGroup);\n                    stmt.setObject(1, userId);\n                    stmt.executeQuery();\n                }\n                \n                \n                if(!userGroups.startsWith(\"#form.info_colaboradores.grupos\") && userGroups != null && !userGroups.isEmpty() ){\n                    String[] groupsParsed = userGroups.split(\";\");\n                    String userId = \"#form.info_colaboradores.user_colaborador#\";\n                    String queryDeleteGroup = \"DELETE FROM dir_user_group WHERE userId = ? ;\";\n                    \n                    stmt = con.prepareStatement(queryDeleteGroup);\n                    stmt.setObject(1, userId);\n                    stmt.executeQuery();\n                    \n                    for(int i=0; i<groupsParsed.length; i++){\n                        String queryInsertGroup = \"INSERT INTO dir_user_group (groupId, userId) VALUES (?,?) ;\";\n                        stmt = con.prepareStatement(queryInsertGroup);\n                        stmt.setObject(1, groupsParsed[i]);\n                        stmt.setObject(2, userId);\n                        stmt.executeQuery();\n                    }\n                    \n                }\n             }\n             \n        }catch(Exception e){\n            LogUtil.error(appDef.toString(), e, \"Error getting info from DB\");\n        }finally{\n            try{\n                if(rs != null){\n                rs.close();\n                }\n                if(stmt != null){\n                    stmt.close();\n                }\n                if(con != null && !con.isClosed()) {\n                    con.close();\n                }\n            }catch(Exception e){\n                LogUtil.error(appDef.toString(), e, \"Error closing DB connection\");\n            }\n            \n        }\n        \n        \n        \n        \n    }catch(Exception e){\n        LogUtil.error(appDef.toString(), e, \"Error creating process\");\n    }\n\n\n\nreturn null;\n}\n  \n//call execute method with injected variable\nreturn execute(appDef, request);\n   \n\n"}
        },
        "postProcessorRunOn": "both",
        "storeBinder": {
            "className": "org.joget.apps.form.lib.WorkflowFormBinder",
            "properties": {}
        },
        "tableName": "info_colaboradores"
    }
}